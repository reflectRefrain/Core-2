<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>A+ 220-1102 • Andrew Ramdayal Course Tracker</title>
<style>
  :root{
    --bg:#0f1115;--card:#171a21;--muted:#9aa4b2;--text:#e6e9ef;--brand:#6bc4ff;--accent:#64d2ff;--ok:#4ade80;--warn:#fbbf24;--bad:#f87171;--chip:#243244;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:linear-gradient(180deg,#0b1220,#0a0d13 30%,#0b1017);color:var(--text)}
  header{position:sticky;top:0;z-index:5;background:rgba(11,16,23,.8);backdrop-filter:blur(10px);border-bottom:1px solid #1f2733}
  .wrap{max-width:980px;margin:0 auto;padding:14px}
  h1{font-size:20px;margin:6px 0 2px}
  .sub{color:var(--muted);font-size:13px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  button,input,select,textarea{font:inherit}
  .btn{background:#1f2a37;color:var(--text);border:1px solid #2a3a4d;border-radius:10px;padding:10px 12px;cursor:pointer}
  .btn:active{transform:translateY(1px)}
  .brand{border-color:#2b4c6b;background:#1b2430}
  .ok{background:#13321d;border-color:#1f5e2d}
  .warn{background:#3a2e12;border-color:#735d16}
  .muted{color:var(--muted)}
  .grid{display:grid;gap:12px}
  .card{background:var(--card);border:1px solid #212b39;border-radius:14px;padding:14px}
  .pill{display:inline-flex;align-items:center;gap:6px;background:var(--chip);border:1px solid #2b3d55;color:#bcd6ff;padding:6px 10px;border-radius:999px;font-size:12px}
  .progress{height:10px;background:#0e1622;border:1px solid #1d2a3b;border-radius:999px;overflow:hidden}
  .bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--accent));transition:width .3s}
  details summary{cursor:pointer;color:#bcd6ff}
  .two{display:grid;gap:12px}
  @media(min-width:760px){.two{grid-template-columns:1fr 1fr}}
  .section{display:grid;gap:10px;background:#121824;border:1px solid #1d2938;border-radius:12px;padding:12px}
  .item{display:flex;gap:10px;align-items:flex-start}
  .item input{transform:translateY(2px)}
  textarea{width:100%;min-height:70px;background:#0d131c;border:1px solid #1b2736;color:var(--text);border-radius:10px;padding:10px}
  .list{display:grid;gap:8px}
  .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#0e1520;border:1px solid #1b2a3f;border-radius:8px;padding:2px 6px}
  .copy{cursor:pointer;border:1px dashed #35527a;border-radius:8px;padding:2px 6px;margin-left:6px}
  .footer{opacity:.7;font-size:12px;padding:20px 0}
  .chip{background:#0f1a26;border:1px solid #1d2c3f;border-radius:10px;padding:8px 10px}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="row" style="justify-content:space-between">
      <div>
        <h1>A+ 220-1102 • Andrew Ramdayal Course Tracker</h1>
        <div class="sub">Plan: <span class="pill">Andrew Ramdayal (Udemy)</span> <span class="pill">Jason Dion Practice Exams</span></div>
      </div>
      <div class="row">
        <button class="btn brand" id="exportBtn">Export</button>
        <label class="btn" for="importFile">Import</label>
        <input id="importFile" type="file" accept="application/json" style="display:none">
        <button class="btn" id="resetBtn">Reset</button>
      </div>
    </div>

    <div class="grid" style="margin-top:12px">
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div class="row">
            <div class="pill">Domain-Weighted Progress: <b id="pct">0%</b></div>
            <div class="pill">Sections Done: <b id="doneCount">0</b>/<b id="totalCount">0</b></div>
            <div class="pill">Streak: <b id="streak">0</b> days</div>
          </div>
          <div class="row">
            <label class="pill">Target Exam Date:
              <input type="date" id="examDate" style="background:#0e1622;border:1px solid #243245;color:#cfe1ff;border-radius:8px;padding:6px;margin-left:6px">
            </label>
          </div>
        </div>
        <div class="progress" style="margin-top:10px"><div class="bar" id="bar"></div></div>
        <div class="sub" id="countdown" style="margin-top:8px"></div>
        <div class="sub" id="nextUp" style="margin-top:4px;color:#b7f5ff"></div>
      </div>
    </div>
  </div>
</header>

<main class="wrap grid" style="margin-top:14px">

  <!-- Flashcards / Glossary -->
  <section class="two">
    <div class="card">
      <h3 style="margin:0 0 8px">Flashcards • Section-Aware</h3>
      <div class="row">
        <button class="btn" id="fcPrev">◀</button>
        <button class="btn brand" id="fcFlip">Flip</button>
        <button class="btn ok" id="fcKnown">Known</button>
        <button class="btn warn" id="fcUnknown">Review</button>
        <select id="fcSection" class="btn"></select>
        <button class="btn" id="fcReset">Reset Deck</button>
      </div>
      <div id="fcCard" class="card" style="margin-top:10px;background:#0f1622;text-align:center;min-height:110px;display:flex;align-items:center;justify-content:center;border-style:dashed">
        <div>
          <div id="fcFront" style="font-weight:700;font-size:18px"></div>
          <div id="fcBack" style="margin-top:6px;color:var(--muted)"></div>
        </div>
      </div>
      <div class="sub" id="fcStatus" style="margin-top:6px"></div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px">Glossary & Quick-Copy</h3>
      <input id="search" placeholder="Search commands, acronyms, policies…" style="width:100%;background:#0d131c;border:1px solid #1b2736;color:var(--text);border-radius:10px;padding:10px">
      <div id="results" class="list" style="margin-top:10px"></div>
      <details style="margin-top:10px">
        <summary>Common Windows / Linux Commands</summary>
        <div class="list" style="margin-top:10px">
          <div>Windows: <span class="kbd">sfc /scannow</span><span class="copy" data-copy="sfc /scannow">Copy</span> — verify system files</div>
          <div>Windows: <span class="kbd">dism /online /cleanup-image /restorehealth</span><span class="copy" data-copy="dism /online /cleanup-image /restorehealth">Copy</span> — repair component store</div>
          <div>Windows: <span class="kbd">ipconfig /all</span><span class="copy" data-copy="ipconfig /all">Copy</span> — IP details</div>
          <div>Windows: <span class="kbd">gpupdate /force</span><span class="copy" data-copy="gpupdate /force">Copy</span> — refresh policies</div>
          <div>Linux: <span class="kbd">chmod 755 file</span><span class="copy" data-copy="chmod 755 file">Copy</span> — permissions</div>
          <div>Linux: <span class="kbd">grep -R "text" /path</span><span class="copy" data-copy='grep -R "text" /path'>Copy</span> — recursive search</div>
        </div>
      </details>
    </div>
  </section>

  <!-- Course Map -->
  <section class="card">
    <h3 style="margin:0 0 6px">Andrew’s Course Sections (Domain-weighted)</h3>
    <div class="sub">Follow the sequence. Each checklist item maps to Andrew’s topics and PBQ-style actions.</div>
    <div id="sections" class="grid" style="margin-top:12px"></div>
  </section>

  <!-- Practice Exams -->
  <section class="card">
    <h3 style="margin:0 0 6px">Jason Dion Practice Exam Tracker</h3>
    <div class="sub">Target ≥ 80% before moving on. Tag mistakes with the related section.</div>
    <div id="exams" class="grid" style="margin-top:10px"></div>
  </section>

  <!-- PBQ + Final Checks -->
  <section class="two">
    <div class="card">
      <h3 style="margin:0 0 6px">PBQ Readiness (Hands-on goals)</h3>
      <div id="pbq" class="list"></div>
    </div>
    <div class="card">
      <h3 style="margin:0 0 6px">Final 48-Hour Checklist</h3>
      <div id="final48" class="list"></div>
    </div>
  </section>

  <section class="footer muted">
    Tip: Export your progress JSON before switching devices. Everything saves locally in your browser.
  </section>
</main>

<script>
/* ===================== CONFIG ===================== */
/* Domain weights per CompTIA Core 2 blueprint */
const DOMAIN_WEIGHTS = {
  "1. Operating Systems": 31,
  "2. Security": 25,
  "3. Software Troubleshooting": 22,
  "4. Operational Procedures": 22
};

/* Andrew Ramdayal – Section map (edit names if you wish) */
const COURSE_MAP = [
  {
    domain:"1. Operating Systems",
    code:"1.1",
    title:"Windows Editions & Features",
    items:[
      "Identify Win10/11 Home/Pro/Enterprise features and min HW.",
      "Hands-on: Settings vs Control Panel; Device Manager; Power Options.",
      "Know update channels & activation basics."
    ],
    flashcards:[
      ["Win Editions","Home / Pro / Enterprise – feature deltas (BitLocker, Domain Join, Hyper-V)."],
      ["Requirements","Win11: TPM 2.0, UEFI/Secure Boot, CPU/Storage/RAM minimums."]
    ]
  },
  {
    domain:"1. Operating Systems",
    code:"1.2",
    title:"Command-Line & Admin Tools",
    items:[
      "Drill: help, dir, cd, md, rd, del, tree, winver, cls.",
      "Copy tools: copy, xcopy, robocopy.",
      "Net tools: ping (common flags), ipconfig /all,/renew,/release, netstat, tracert, nslookup, hostname, pathping.",
      "Repair/admin: sfc /scannow, dism /restorehealth, gpupdate, gpresult."
    ],
    flashcards:[
      ["SFC vs DISM","SFC repairs protected files; DISM repairs component store."],
      ["ipconfig trio","/all = detail; /release releases lease; /renew requests new lease."]
    ]
  },
  {
    domain:"1. Operating Systems",
    code:"1.3",
    title:"Users, Groups, UAC & Policies",
    items:[
      "Create local users; compare Standard vs Admin vs Power User.",
      "Understand UAC prompts & elevation behavior.",
      "Local Security Policy & services basics."
    ],
    flashcards:[
      ["Least Privilege","Grant only the rights needed to do the job."],
      ["UAC","Prevents unauthorized changes; prompts for elevation."]
    ]
  },
  {
    domain:"1. Operating Systems",
    code:"1.4",
    title:"File Systems, Encryption & Recovery",
    items:[
      "NTFS vs Share permissions (effective = most restrictive).",
      "BitLocker, BitLocker To Go vs EFS – when to use which.",
      "Recovery: Safe Mode, Startup Repair, System Restore, Reset/WinRE."
    ],
    flashcards:[
      ["Permissions precedence","Deny > Allow; explicit > inherited."],
      ["BitLocker vs EFS","Disk vs file/folder encryption (NTFS only)."]
    ]
  },
  {
    domain:"1. Operating Systems",
    code:"1.5",
    title:"Workgroup vs Domain & Networking Basics",
    items:[
      "Workgroup shares, mapped drives; domain join concept.",
      "Firewall profiles & per-app rules; RDP basics.",
      "Core 1 refresher: private IP, ports you still see in 1102 questions."
    ],
    flashcards:[
      ["Workgroup","Peer-to-peer, local accounts."],
      ["Domain","Central auth via AD; GPOs apply."]
    ]
  },
  {
    domain:"1. Operating Systems",
    code:"1.6",
    title:"macOS & Linux Essentials",
    items:[
      "macOS basics; Time Machine; Disk Utility; Spotlight; Gatekeeper.",
      "Linux basics; ownership/permissions; package managers (apt, yum/dnf).",
      "Common cross-platform commands and paths."
    ],
    flashcards:[
      ["chmod 755","rwx r-x r-x; 4/2/1 weighting."],
      ["Package mgmt","apt/yum; repo, update, upgrade, install."]
    ]
  },

  /* ===== Security ===== */
  {
    domain:"2. Security",
    code:"2.1",
    title:"Threats & Attacks",
    items:[
      "Malware: virus, worm, trojan, ransomware, rootkit, keylogger.",
      "Social engineering: phishing, spear, vishing, smishing, pretexting.",
      "Network threats: DoS/DDoS, MITM, spoofing, brute force."
    ],
    flashcards:[
      ["Phishing vs Spear","Bulk vs targeted with context."],
      ["MITM","Attacker sits in the flow to intercept/alter data."]
    ]
  },
  {
    domain:"2. Security",
    code:"2.2",
    title:"Hardening Workstations",
    items:[
      "Account policies: lockout, password length/history, MFA.",
      "Updates/patching; disable autorun; secure DNS.",
      "Secure BIOS/UEFI: passwords, Secure Boot, drive order."
    ],
    flashcards:[
      ["MFA","Combine factors (something you know/have/are)."],
      ["Secure Boot","Blocks unsigned boot loaders."]
    ]
  },
  {
    domain:"2. Security",
    code:"2.3",
    title:"Wireless & Information Security Standards",
    items:[
      "WEP vs WPA2 vs WPA3; AES vs TKIP; SAE; open networks (OWE).",
      "RADIUS/802.1X/Enterprise vs PSK; guest networks & captive portals.",
      "PII/PHI handling; data classification; DLP basics."
    ],
    flashcards:[
      ["WPA3","Uses SAE; stronger against offline attacks."],
      ["802.1X","Port-based NAC with RADIUS."]
    ]
  },
  {
    domain:"2. Security",
    code:"2.4",
    title:"Windows Security Settings",
    items:[
      "Defender AV/Firewall; enabling, updating defs, exclusions.",
      "Per-app firewall rules; inbound/outbound basics.",
      "NTFS vs Share perms review; UAC tuning."
    ],
    flashcards:[
      ["Effective permissions","Most restrictive wins."],
      ["UAC levels","Notify behavior for user/admin."]
    ]
  },
  {
    domain:"2. Security",
    code:"2.5",
    title:"Encryption & Data Protection",
    items:[
      "BitLocker (TPM) & BitLocker To Go; EFS; recovery keys.",
      "Device encryption on laptops/mobile; secure wipe vs shred.",
      "Backups: full/diff/incremental tradeoffs."
    ],
    flashcards:[
      ["Recovery planning","Store BitLocker recovery keys securely."],
      ["Backup sets","Full+diff vs full+incremental."]
    ]
  },

  /* ===== Software Troubleshooting ===== */
  {
    domain:"3. Software Troubleshooting",
    code:"3.1",
    title:"Troubleshooting Methodology & Tools",
    items:[
      "Apply the 6 steps; respect policies before changes.",
      "Logs (Event Viewer), msconfig/services, Task Manager.",
      "Safe Mode, Startup Repair, bootrec, SFC/DISM sequence."
    ],
    flashcards:[
      ["Order of ops","Identify → Theory → Test → Plan → Verify → Document"],
      ["bootrec","/fixmbr /fixboot /rebuildbcd"]
    ]
  },
  {
    domain:"3. Software Troubleshooting",
    code:"3.2",
    title:"Common Symptoms & Fixes",
    items:[
      "BSODs & crashes (drivers/RAM); app crashes; services not starting.",
      "Browser hijack/malware; slow profile; update loops.",
      "No-boot: missing OS, boot loops, device order issues."
    ],
    flashcards:[
      ["Hijack signs","Homepage/search redirect, odd extensions."],
      ["BSOD triage","Check recent drivers/updates; analyze stop code."]
    ]
  },

  /* ===== Operational Procedures ===== */
  {
    domain:"4. Operational Procedures",
    code:"4.1",
    title:"Safety, Environmental & Documentation",
    items:[
      "ESD, MSDS/SDS, battery/toner handling, lifting safety.",
      "Asset/inventory, ticketing, change management, SOPs.",
      "Disposal: wipe vs degauss vs shred; chain of custody."
    ],
    flashcards:[
      ["Chain of custody","Who/what/when/where for evidence handling."],
      ["E-waste","Follow policy & legal requirements."]
    ]
  },
  {
    domain:"4. Operational Procedures",
    code:"4.2",
    title:"Professionalism & Best Practices",
    items:[
      "Communication, escalation, SLAs, documentation quality.",
      "Remote support etiquette; permission & privacy.",
      "Licensing basics; scope/impact assessment."
    ],
    flashcards:[
      ["SLA","Uptime/response guarantees & penalties."],
      ["Scope creep","Lock scope; change control for adds."]
    ]
  }
];

/* PBQ & Final 48h checklists */
const PBQ_TASKS = [
  "Create a Windows local user, set password policy, test UAC behavior.",
  "Fix a no-boot: Safe Mode → Startup Repair → bootrec → SFC/DISM.",
  "Choose correct Wi-Fi security (WPA3 vs WPA2), create firewall rule.",
  "Resolve access denied via NTFS vs Share permissions & inheritance.",
  "Perform malware removal in order, then post-incident hardening."
];
const FINAL_48 = [
  "Redrill Windows/Linux/macOS commands & switches.",
  "Review Operational Procedures (docs, safety, disposal, chain of custody).",
  "Recheck security protocols & MFA/password policy concepts.",
  "Skim your weak-topic flashcards and notes.",
  "Sleep 7–8 hours; test center/online check-in logistics ready."
];

/* Jason Dion exams */
const EXAMS = ["A","B","C","D","E","F"];

/* ===================== STATE ===================== */
const KEY='a1102_andrew_tracker_v2';
const state = load() || {
  examDate:'', checks:{}, notes:{}, exams:{}, fc:{known:[],unknown:[],i:0,showBack:false,filter:"All"},
  streak:0,lastDone:''
};

/* ===================== UI BUILD ===================== */
const sectionsEl = document.getElementById('sections');
const examsEl = document.getElementById('exams');
const pbqEl = document.getElementById('pbq');
const finalEl = document.getElementById('final48');
const totalCountEl = document.getElementById('totalCount');

function buildSections(){
  sectionsEl.innerHTML='';
  COURSE_MAP.forEach((s, idx)=>{
    const id = `${s.code}-${s.title}`;
    const div=document.createElement('div');
    div.className='section';
    div.innerHTML = `
      <h4 style="margin:0">${s.domain} • ${s.code} — ${s.title}</h4>
      <div class="list">
        ${s.items.map((t,i)=>`
          <label class="item"><input type="checkbox" data-k="sec:${idx}:${i}"> <span>${t}</span></label>
        `).join('')}
      </div>
      <details style="margin-top:8px"><summary>Notes</summary>
        <textarea data-note="sec:${idx}" placeholder="What didn’t stick? Summarize the fix here."></textarea>
      </details>
      ${s.flashcards?.length?`<details style="margin-top:8px"><summary>Section Flashcards</summary>
        <div class="list">${s.flashcards.map(fc=>`<div class="chip"><b>${fc[0]}:</b> ${fc[1]}</div>`).join('')}</div>
      </details>`:''}
    `;
    sectionsEl.appendChild(div);
  });
}

function buildExams(){
  examsEl.innerHTML='';
  EXAMS.forEach(letter=>{
    const k=`dion${letter}`;
    const eDiv=document.createElement('div');
    eDiv.className='section';
    eDiv.innerHTML=`
      <div class="row" style="justify-content:space-between">
        <h4 style="margin:0">Jason Dion Exam ${letter}</h4>
        <label class="pill">Score:
          <input type="number" min="0" max="100" step="1" data-exam-score="${k}"
            style="width:72px;background:#0e1622;border:1px solid #243245;color:#cfe1ff;border-radius:8px;padding:6px;margin-left:6px">%
        </label>
      </div>
      <div class="row">
        <label class="item"><input type="checkbox" data-exam-done="${k}"> Mark complete</label>
        <select class="btn" data-exam-domain="${k}">
          <option value="">Tag weak area →</option>
          ${[...new Set(COURSE_MAP.map(s=>s.domain))].map(d=>`<option>${d}</option>`).join('')}
        </select>
      </div>
      <details style="margin-top:8px"><summary>Review notes (map misses back to sections)</summary>
        <textarea data-exam-note="${k}" placeholder="List unknown terms + their matching section (e.g., 1.2, 2.4)."></textarea>
      </details>
    `;
    examsEl.appendChild(eDiv);
  });
}

function buildPBQ(){
  pbqEl.innerHTML= PBQ_TASKS.map((t,i)=>`
    <label class="item"><input type="checkbox" data-k="pbq:${i}"> <span>${t}</span></label>
  `).join('');
}
function buildFinal(){
  finalEl.innerHTML= FINAL_48.map((t,i)=>`
    <label class="item"><input type="checkbox" data-k="final:${i}"> <span>${t}</span></label>
  `).join('');
}

buildSections(); buildExams(); buildPBQ(); buildFinal();

/* Gather elements after build */
const planChecks = [...document.querySelectorAll('input[type="checkbox"][data-k]')];
const planNotes = [...document.querySelectorAll('textarea[data-note]')];
const examScores = [...document.querySelectorAll('input[data-exam-score]')];
const examDone = [...document.querySelectorAll('input[data-exam-done]')];
const examNotes = [...document.querySelectorAll('textarea[data-exam-note]')];
const examDomain = [...document.querySelectorAll('select[data-exam-domain]')];

/* ===================== WEIGHTED PROGRESS ===================== */
function weightedProgress(){
  // For each domain, compute completion ratio of its items
  const domainStats = {};
  COURSE_MAP.forEach((s, si)=>{
    const items = s.items.length;
    const done = s.items.filter((_,i)=> state.checks[`sec:${si}:${i}`]).length;
    (domainStats[s.domain]??=( {done:0,total:0} ));
    domainStats[s.domain].done += done;
    domainStats[s.domain].total += items;
  });
  let weighted=0, totalWeight=0;
  Object.keys(DOMAIN_WEIGHTS).forEach(d=>{
    const w = DOMAIN_WEIGHTS[d]||0;
    const stat = domainStats[d]||{done:0,total:0};
    const pct = stat.total? (stat.done/stat.total):0;
    weighted += pct*w;
    totalWeight += w;
  });
  return Math.round((weighted/totalWeight)*100);
}

/* ===================== STREAK ===================== */
function markStreak(){
  const today=new Date().toISOString().slice(0,10);
  if(state.lastDone===today) return;
  if(!state.lastDone){ state.streak=1; state.lastDone=today; return; }
  const d1=new Date(state.lastDone), d2=new Date(today);
  const diff=(d2-d1)/(1000*60*60*24);
  state.streak = (diff===1)? state.streak+1 : 1;
  state.lastDone=today;
}

/* ===================== SYNC UI ===================== */
function totalItemsCount(){
  const planCount = COURSE_MAP.reduce((a,s)=>a+s.items.length,0);
  const miscCount = PBQ_TASKS.length + FINAL_48.length + EXAMS.length; // we’ll treat each exam completion as an item
  return planCount + miscCount;
}
function doneItemsCount(){
  const planDone = Object.keys(state.checks).filter(k=>k.startsWith('sec:') && state.checks[k]).length;
  const pbqDone = PBQ_TASKS.map((_,i)=>state.checks[`pbq:${i}`]).filter(Boolean).length;
  const finalDone = FINAL_48.map((_,i)=>state.checks[`final:${i}`]).filter(Boolean).length;
  const examsDone = EXAMS.map(l=>state.exams[`dion${l}`]?.done).filter(Boolean).length;
  return planDone + pbqDone + finalDone + examsDone;
}

function syncUI(){
  // checks
  planChecks.forEach(c=> c.checked = !!state.checks[c.dataset.k]);
  // section notes
  planNotes.forEach(t=> t.value = state.notes[t.dataset.note] ?? '');
  // exams
  examScores.forEach(e=>{
    const k=e.dataset.examScore;
    e.value = state.exams[k]?.score ?? '';
  });
  examDone.forEach(e=>{
    const k=e.dataset.examDone;
    e.checked = !!state.exams[k]?.done;
  });
  examNotes.forEach(t=>{
    const k=`note:${t.dataset.examNote}`;
    t.value = state.notes[k] ?? '';
  });
  examDomain.forEach(s=>{
    const k=s.dataset.examDomain;
    s.value = state.exams[k]?.domain ?? '';
  });

  // progress
  const weighted = weightedProgress();
  const pctEl = document.getElementById('pct');
  pctEl.textContent = weighted+'%';
  document.getElementById('bar').style.width = weighted+'%';
  document.getElementById('doneCount').textContent = doneItemsCount();
  document.getElementById('totalCount').textContent = totalItemsCount();

  // streak
  document.getElementById('streak').textContent = state.streak||0;

  // next up suggestion
  nextSuggestion();

  // countdown
  renderCountdown();
}
syncUI();

/* ===================== EVENTS ===================== */
document.addEventListener('change', (e)=>{
  const t=e.target;
  if(t.matches('input[type="checkbox"][data-k]')){
    state.checks[t.dataset.k]=t.checked;
    if(t.checked) markStreak();
    save(); syncUI();
  }
  if(t.matches('textarea[data-note]')){
    state.notes[t.dataset.note]=t.value; save();
  }
  if(t.matches('input[data-exam-score]')){
    const k=t.dataset.examScore;
    state.exams[k]=state.exams[k]||{};
    state.exams[k].score=t.value; save();
  }
  if(t.matches('input[data-exam-done]')){
    const k=t.dataset.examDone;
    state.exams[k]=state.exams[k]||{};
    state.exams[k].done=t.checked;
    if(t.checked) markStreak();
    save(); syncUI();
  }
  if(t.matches('textarea[data-exam-note]')){
    const k=`note:${t.dataset.examNote}`;
    state.notes[k]=t.value; save();
  }
  if(t.matches('select[data-exam-domain]')){
    const k=t.dataset.examDomain;
    state.exams[k]=state.exams[k]||{};
    state.exams[k].domain=t.value; save();
  }
  if(t.id==='examDate'){
    state.examDate=t.value; save(); renderCountdown();
  }
});

/* Export/Import/Reset */
document.getElementById('exportBtn').onclick=()=>{
  const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;a.download='a1102_andrew_progress.json';a.click();
  URL.revokeObjectURL(url);
};
document.getElementById('importFile').onchange=(e)=>{
  const f=e.target.files[0]; if(!f) return;
  const r=new FileReader();
  r.onload=()=>{ try{ const obj=JSON.parse(r.result); Object.assign(state,obj); save(); location.reload(); }catch(err){alert('Invalid JSON');} };
  r.readAsText(f);
};
document.getElementById('resetBtn').onclick=()=>{
  if(confirm('Clear all saved progress?')){ localStorage.removeItem(KEY); location.reload(); }
};

/* Countdown */
function renderCountdown(){
  const el=document.getElementById('countdown');
  if(!state.examDate){ el.textContent='Set an exam date to get a countdown.'; return; }
  const now=new Date();
  const d=new Date(state.examDate+'T00:00:00');
  const diff=Math.ceil((d-now)/(1000*60*60*24));
  el.textContent = diff>=0 ? `⏳ ${diff} day(s) until exam.` : `✅ Exam date passed (${Math.abs(diff)} day(s) ago).`;
}

/* Next-Up (sequential by course order) */
function nextSuggestion(){
  // first unchecked section item in COURSE_MAP order
  for(let si=0; si<COURSE_MAP.length; si++){
    const s=COURSE_MAP[si];
    for(let ii=0; ii<s.items.length; ii++){
      if(!state.checks[`sec:${si}:${ii}`]){
        document.getElementById('nextUp').textContent = `Next up: ${s.domain} → ${s.code} — ${s.title} → ${s.items[ii]}`;
        return;
      }
    }
  }
  // else exams, then pbq, then final
  for(const l of EXAMS){
    if(!state.exams[`dion${l}`]?.done){
      document.getElementById('nextUp').textContent = `Next up: Jason Dion Exam ${l} (timed)`;
      return;
    }
  }
  for(let i=0;i<PBQ_TASKS.length;i++){
    if(!state.checks[`pbq:${i}`]){ document.getElementById('nextUp').textContent = `Next up: ${PBQ_TASKS[i]}`; return; }
  }
  for(let i=0;i<FINAL_48.length;i++){
    if(!state.checks[`final:${i}`]){ document.getElementById('nextUp').textContent = `Next up: ${FINAL_48[i]}`; return; }
  }
  document.getElementById('nextUp').textContent = 'All tasks complete. Light review + rest.';
}

/* ===================== FLASHCARDS ===================== */
const fcSelect = document.getElementById('fcSection');
function fcSections(){
  const opts = ["All", ...COURSE_MAP.map(s=>`${s.code} — ${s.title}`)];
  fcSelect.innerHTML = opts.map(o=>`<option ${state.fc.filter===o?'selected':''}>${o}</option>`).join('');
}
fcSections();
fcSelect.addEventListener('change',()=>{
  state.fc.filter = fcSelect.value; state.fc.known=[]; state.fc.unknown=[]; state.fc.i=0; state.fc.showBack=false; save(); fcInit();
});

function buildDeck(){
  const pairs=[];
  COURSE_MAP.forEach(s=>{
    (s.flashcards||[]).forEach(fc=>{
      pairs.push({sec:`${s.code} — ${s.title}`,front:fc[0],back:fc[1]});
    });
  });
  return pairs;
}
let DECK = buildDeck();

function filterDeck(){
  if(state.fc.filter==="All") return DECK;
  return DECK.filter(c=>c.sec===state.fc.filter);
}

function fcInit(){
  const pool = filterDeck();
  if(!pool.length){
    document.getElementById('fcFront').textContent='No flashcards in this section.';
    document.getElementById('fcBack').textContent='Select “All” or another section.';
    document.getElementById('fcStatus').textContent='';
    return;
  }
  // initialize unknown as indices of pool
  if(!state.fc.unknown.length && !state.fc.known.length){
    state.fc.unknown = pool.map((_,i)=>i);
    state.fc.known = []; state.fc.i=0; state.fc.showBack=false; save();
  }
  fcRender();
}

function fcCurrent(){
  const pool = filterDeck();
  const active = state.fc.unknown.length? state.fc.unknown : state.fc.known;
  if(!active.length) return null;
  const idx = Math.min(state.fc.i, active.length-1);
  return {pool, idx, card: pool[ active[idx] ]};
}

function fcRender(){
  const cur = fcCurrent();
  const f=document.getElementById('fcFront'), b=document.getElementById('fcBack'), s=document.getElementById('fcStatus');
  if(!cur){ f.textContent='Deck empty'; b.textContent='Reset deck'; s.textContent=''; return; }
  f.textContent = cur.card.front + (state.fc.filter==="All" ? `  ·  ${cur.card.sec}` : "");
  b.textContent = state.fc.showBack? cur.card.back : 'Tap “Flip” to reveal';
  s.textContent = `Unknown: ${state.fc.unknown.length} • Known: ${state.fc.known.length}`;
}

function fcFlip(){ state.fc.showBack=!state.fc.showBack; save(); fcRender(); }
function fcAdvance(dir=1){
  const active = state.fc.unknown.length? state.fc.unknown : state.fc.known;
  state.fc.i = (state.fc.i + dir + active.length) % active.length;
  state.fc.showBack=false; save(); fcRender();
}
function fcMove(toKnown){
  const cur = fcCurrent(); if(!cur) return;
  const activeUnknown = state.fc.unknown;
  const activeKnown = state.fc.known;
  // remove from pools
  state.fc.unknown = activeUnknown.filter(i=>i!==activeUnknown[state.fc.i]);
  state.fc.known   = activeKnown.filter(i=>i!==activeUnknown[state.fc.i]);
  (toKnown? state.fc.known: state.fc.unknown).push(cur.pool.indexOf(cur.card));
  state.fc.showBack=false; save(); fcRender();
}
document.getElementById('fcFlip').onclick=fcFlip;
document.getElementById('fcPrev').onclick=()=>fcAdvance(-1);
document.getElementById('fcKnown').onclick=()=>fcMove(true);
document.getElementById('fcUnknown').onclick=()=>fcMove(false);
document.getElementById('fcReset').onclick=()=>{ state.fc.known=[]; state.fc.unknown=[]; state.fc.i=0; state.fc.showBack=false; save(); fcInit(); };
fcInit();

/* ===================== GLOSSARY SEARCH ===================== */
const GLOSSARY = [
 {k:'sfc',v:'System File Checker — verify/repair protected Windows files.'},
 {k:'dism',v:'Deployment Image Servicing and Management — repair component store.'},
 {k:'bitlocker',v:'Full-disk encryption for Windows (TPM recommended).'},
 {k:'efs',v:'Encrypting File System — per-file encryption (NTFS only).'},
 {k:'uac',v:'User Account Control — prompts for elevation.'},
 {k:'ntfs',v:'Permissions: read/write/modify/full. Most restrictive takes effect.'},
 {k:'share permissions',v:'Apply only over network; combine with NTFS.'},
 {k:'wpa2',v:'Wi-Fi security (AES/TKIP) — legacy compared to WPA3.'},
 {k:'wpa3',v:'Wi-Fi security using SAE; better resistance to offline attacks.'},
 {k:'apipa',v:'169.254.x.x when no DHCP lease (Core 1 refresher).'},
 {k:'bsod',v:'Kernel crash; check drivers, RAM, recent changes.'},
 {k:'gpupdate',v:'Refresh Group Policy (Windows).'},
 {k:'chmod',v:'Change file mode bits (Linux/macOS).'},
 {k:'grep',v:'Search text with regex; -R for recursive.'},
 {k:'chain of custody',v:'Evidence handling log for forensics.'},
 {k:'mfa',v:'Multi-factor auth: know/have/are.'},
 {k:'sla',v:'Service Level Agreement — uptime/response guarantees.'},
];
const resEl=document.getElementById('results');
document.getElementById('search').addEventListener('input', e=>{
  const q=e.target.value.toLowerCase().trim();
  resEl.innerHTML=''; if(!q) return;
  GLOSSARY.filter(x=>x.k.includes(q)||x.v.toLowerCase().includes(q)).slice(0,12).forEach(x=>{
    const row=document.createElement('div'); row.className='chip'; row.innerHTML = `<b>${x.k}</b> — ${x.v}`; resEl.appendChild(row);
  });
});

/* ===================== COPY BUTTONS ===================== */
document.querySelectorAll('.copy').forEach(btn=>{
  btn.addEventListener('click', ()=>navigator.clipboard.writeText(btn.dataset.copy));
});

/* ===================== STORAGE ===================== */
function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }
function load(){ try{ return JSON.parse(localStorage.getItem(KEY)||''); }catch(e){ return null; } }

/* Init exam date */
document.addEventListener('DOMContentLoaded',()=>{
  if(state.examDate) document.getElementById('examDate').value=state.examDate;
  syncUI();
});
</script>
</body>
</html>
