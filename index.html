<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>A+ 220-1102 ‚Ä¢ Andrew Course Tracker + Schedule</title>
<style>
  :root{
    --bg:#0f1115;--card:#171a21;--muted:#9aa4b2;--text:#e6e9ef;--brand:#6bc4ff;--accent:#64d2ff;--ok:#4ade80;--warn:#fbbf24;--bad:#f87171;--chip:#243244;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:linear-gradient(180deg,#0b1220,#0a0d13 30%,#0b1017);color:var(--text)}
  header{position:sticky;top:0;z-index:10;background:rgba(11,16,23,.9);backdrop-filter:blur(10px);border-bottom:1px solid #1f2733}
  .wrap{max-width:980px;margin:0 auto;padding:14px}
  h1{font-size:20px;margin:6px 0 2px}
  .sub{color:var(--muted);font-size:13px}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  button,input,select,textarea{font:inherit}
  .btn{background:#1f2a37;color:var(--text);border:1px solid #2a3a4d;border-radius:10px;padding:10px 12px;cursor:pointer}
  .btn:active{transform:translateY(1px)}
  .brand{border-color:#2b4c6b;background:#1b2430}
  .ok{background:#13321d;border-color:#1f5e2d}
  .warn{background:#3a2e12;border-color:#735d16}
  .danger{background:#2b1212;border-color:#6a1e1e}
  .muted{color:var(--muted)}
  .grid{display:grid;gap:12px}
  .card{background:var(--card);border:1px solid #212b39;border-radius:14px;padding:14px}
  .pill{display:inline-flex;align-items:center;gap:6px;background:var(--chip);border:1px solid #2b3d55;color:#bcd6ff;padding:6px 10px;border-radius:999px;font-size:12px}
  .progress{height:10px;background:#0e1622;border:1px solid #1d2a3b;border-radius:999px;overflow:hidden}
  .bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand),var(--accent));transition:width .3s}
  details summary{cursor:pointer;color:#bcd6ff}
  .two{display:grid;gap:12px}
  @media(min-width:760px){.two{grid-template-columns:1fr 1fr}}
  .section{display:grid;gap:10px;background:#121824;border:1px solid #1d2938;border-radius:12px;padding:12px}
  .item{display:flex;gap:10px;align-items:flex-start}
  .item input{transform:translateY(2px)}
  textarea{width:100%;min-height:120px;background:#0d131c;border:1px solid #1b2736;color:var(--text);border-radius:10px;padding:10px}
  .list{display:grid;gap:8px}
  .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,monospace;background:#0e1520;border:1px solid #1b2a3f;border-radius:8px;padding:2px 6px}
  .copy{cursor:pointer;border:1px dashed #35527a;border-radius:8px;padding:2px 6px;margin-left:6px}
  .footer{opacity:.7;font-size:12px;padding:20px 0}
  .chip{background:#0f1a26;border:1px solid #1d2c3f;border-radius:10px;padding:8px 10px}
  .schedule-day{display:flex;justify-content:space-between;align-items:center;border:1px dashed #2b3b52;padding:10px;border-radius:12px}
  .badge{padding:2px 8px;border-radius:999px;border:1px solid #2d4160;background:#0f1a26;color:#cfe1ff;font-size:12px}
  .today{border-color:#3a5b86;background:#101a27}
  .collapsed .header-extra{display:none}
  .collapse-bar{display:flex;align-items:center;gap:8px}
  .chev{font-size:18px;line-height:1}
  /* Glossary overlay */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(2px);display:none;align-items:flex-start;justify-content:center;padding:20px;z-index:999}
  .overlay .panel{max-width:960px;width:100%;background:#0f1622;border:1px solid #22344a;border-radius:14px;padding:14px}
  .link{color:#a7d4ff;text-decoration:underline;cursor:pointer}
</style>
</head>
<body>
<header id="hdr" class="">
  <div class="wrap">
    <div class="row" style="justify-content:space-between">
      <div>
        <h1>A+ 220-1102 ‚Ä¢ Andrew Course Tracker</h1>
        <div class="sub">Plan: <span class="pill">Andrew Ramdayal (Udemy)</span> <span class="pill">Jason Dion Exams</span></div>
      </div>
      <div class="row">
        <button class="btn brand" id="exportBtn" title="Export notes & progress">Export</button>
        <label class="btn" for="importFile">Import</label>
        <input id="importFile" type="file" accept="application/json" style="display:none">
        <button class="btn" id="resetBtn">Reset</button>
        <button class="btn" id="collapseBtn" title="Collapse/Expand header"><span id="chev" class="chev">‚¨Ü</span></button>
      </div>
    </div>

    <div class="grid header-extra" style="margin-top:12px">
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div class="row">
            <div class="pill">Domain Progress: <b id="pct">0%</b></div>
            <div class="pill">Items Done: <b id="doneCount">0</b>/<b id="totalCount">0</b></div>
            <div class="pill">Streak: <b id="streak">0</b> days</div>
          </div>
          <div class="row">
            <label class="pill">Start Date:
              <input type="date" id="startDate" style="background:#0e1622;border:1px solid #243245;color:#cfe1ff;border-radius:8px;padding:6px;margin-left:6px">
            </label>
            <label class="pill">Exam Date:
              <input type="date" id="examDate" style="background:#0e1622;border:1px solid #243245;color:#cfe1ff;border-radius:8px;padding:6px;margin-left:6px">
            </label>
          </div>
        </div>
        <div class="progress" style="margin-top:10px"><div class="bar" id="bar"></div></div>
        <div class="sub" id="countdown" style="margin-top:8px"></div>
        <div class="sub" id="nextUp" style="margin-top:4px;color:#b7f5ff"></div>
      </div>

      <!-- Inline Glossary -->
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center">
          <h3 style="margin:0">Glossary & Quick-Copy</h3>
          <button class="btn" id="openGlossary">üîç Overlay</button>
        </div>
        <input id="search" placeholder="Search commands, acronyms, policies‚Ä¶" style="width:100%;background:#0d131c;border:1px solid #1b2736;color:var(--text);border-radius:10px;padding:10px;margin-top:8px">
        <div id="results" class="list" style="margin-top:10px"></div>
        <details style="margin-top:10px">
          <summary>Common Commands</summary>
          <div class="list" style="margin-top:10px">
            <div>Windows: <span class="kbd">sfc /scannow</span><span class="copy" data-copy="sfc /scannow">Copy</span> ‚Äî verify system files</div>
            <div>Windows: <span class="kbd">dism /online /cleanup-image /restorehealth</span><span class="copy" data-copy="dism /online /cleanup-image /restorehealth">Copy</span> ‚Äî repair component store</div>
            <div>Windows: <span class="kbd">ipconfig /all</span><span class="copy" data-copy="ipconfig /all">Copy</span> ‚Äî IP details</div>
            <div>Windows: <span class="kbd">gpupdate /force</span><span class="copy" data-copy="gpupdate /force">Copy</span> ‚Äî refresh policies</div>
            <div>Linux: <span class="kbd">chmod 755 file</span><span class="copy" data-copy="chmod 755 file">Copy</span> ‚Äî permissions</div>
            <div>Linux: <span class="kbd">grep -R "text" /path</span><span class="copy" data-copy='grep -R "text" /path'>Copy</span> ‚Äî recursive search</div>
          </div>
        </details>
      </div>
    </div>
  </div>
</header>

<!-- Glossary overlay (for collapsed header use) -->
<div id="glossaryOverlay" class="overlay">
  <div class="panel">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h3 style="margin:0">Glossary</h3>
      <button class="btn" id="closeGlossary">Close</button>
    </div>
    <input id="searchOv" placeholder="Search‚Ä¶" style="width:100%;background:#0d131c;border:1px solid #1b2736;color:#e6e9ef;border-radius:10px;padding:10px;margin-top:8px">
    <div id="resultsOv" class="list" style="margin-top:10px;max-height:50vh;overflow:auto"></div>
  </div>
</div>

<main class="wrap grid" style="margin-top:14px">

  <!-- Schedule -->
  <section class="card">
    <div class="row" style="justify-content:space-between;align-items:center">
      <h3 style="margin:0">3-Week Auto Schedule</h3>
      <div class="sub">Set a start or exam date. Today is highlighted. Missed items roll forward.</div>
    </div>
    <div id="schedule" class="grid" style="margin-top:10px"></div>
  </section>

  <!-- Flashcards / Review Queue -->
  <section class="two">
    <div class="card">
      <h3 style="margin:0 0 8px">Flashcards ‚Ä¢ Section-Aware</h3>
      <div class="row">
        <button class="btn" id="fcPrev">‚óÄ</button>
        <button class="btn brand" id="fcFlip">Flip</button>
        <button class="btn ok" id="fcKnown">Known</button>
        <button class="btn warn" id="fcUnknown">Review</button>
        <select id="fcSection" class="btn"></select>
        <button class="btn" id="fcReset">Reset Deck</button>
      </div>
      <div id="fcCard" class="card" style="margin-top:10px;background:#0f1622;text-align:center;min-height:110px;display:flex;align-items:center;justify-content:center;border-style:dashed">
        <div>
          <div id="fcFront" style="font-weight:700;font-size:18px"></div>
          <div id="fcBack" style="margin-top:6px;color:var(--muted)"></div>
        </div>
      </div>
      <div class="sub" id="fcStatus" style="margin-top:6px"></div>
    </div>

    <div class="card">
      <h3 style="margin:0 0 8px">Review Queue</h3>
      <div class="sub">All notes tagged <span class="badge">Needs Review</span> and your custom Q/A flashcards land here.</div>
      <div id="reviewList" class="list" style="margin-top:10px"></div>
      <div class="row">
        <button class="btn brand" id="exportMD">Export .md</button>
        <button class="btn" id="exportCSV">Export .csv</button>
        <button class="btn" id="exportTSV">Export Anki .txt</button>
      </div>
    </div>
  </section>

  <!-- Course Map -->
  <section class="card">
    <h3 style="margin:0 0 6px">Andrew‚Äôs Course Sections (Domain-weighted)</h3>
    <div class="sub">Do the checklist while watching. Tag tough concepts to Review. Use ‚ÄúMake Flashcard‚Äù from Q:/A: in notes.</div>
    <div id="sections" class="grid" style="margin-top:12px"></div>
  </section>

  <!-- Practice Exams -->
  <section class="card">
    <h3 style="margin:0 0 6px">Jason Dion Practice Exam Tracker</h3>
    <div class="sub">Target ‚â• 80% before moving on. Link misses to sections.</div>
    <div id="exams" class="grid" style="margin-top:10px"></div>
  </section>

  <!-- PBQ + Final Checks -->
  <section class="two">
    <div class="card">
      <h3 style="margin:0 0 6px">PBQ Readiness (Hands-on goals)</h3>
      <div id="pbq" class="list"></div>
    </div>
    <div class="card">
      <h3 style="margin:0 0 6px">Final 48-Hour Checklist</h3>
      <div id="final48" class="list"></div>
    </div>
  </section>

  <section class="footer muted">
    Tip: Export your JSON before switching devices. Everything saves locally in your browser.
  </section>
</main>

<script>
/* ===================== CONFIG ===================== */
const DOMAIN_WEIGHTS = {
  "1. Operating Systems": 31,
  "2. Security": 25,
  "3. Software Troubleshooting": 22,
  "4. Operational Procedures": 22
};

const COURSE_MAP = [
  {domain:"1. Operating Systems",code:"1.1",title:"Windows Editions & Features",
   items:["Identify Win10/11 Home/Pro/Enterprise features and min HW.",
          "Hands-on: Settings vs Control Panel; Device Manager; Power Options.",
          "Know update channels & activation basics."],
   flashcards:[["Win Editions","Home/Pro/Enterprise deltas (BitLocker, Domain Join, Hyper-V)."],
               ["Win11 reqs","TPM 2.0, UEFI/Secure Boot, CPU/RAM/Storage minimums."]]},
  {domain:"1. Operating Systems",code:"1.2",title:"Command-Line & Admin Tools",
   items:["help, dir, cd, md, rd, del, tree, winver, cls.",
          "copy, xcopy, robocopy.",
          "ping flags; ipconfig /all,/renew,/release; netstat; tracert; nslookup; hostname; pathping.",
          "sfc /scannow; dism /restorehealth; gpupdate; gpresult."],
   flashcards:[["SFC vs DISM","SFC repairs protected files; DISM fixes component store."],
               ["ipconfig trio","/all detail ‚Ä¢ /release lease ‚Ä¢ /renew new lease"]]},
  {domain:"1. Operating Systems",code:"1.3",title:"Users, Groups, UAC & Policies",
   items:["Create local users; Standard vs Admin vs Power User.",
          "UAC prompts & elevation behavior.",
          "Local Security Policy & services basics."],
   flashcards:[["Least Privilege","Only rights needed to do the job."],
               ["UAC","Consent/elevation for admin tasks."]]},
  {domain:"1. Operating Systems",code:"1.4",title:"File Systems, Encryption & Recovery",
   items:["NTFS vs Share (most restrictive effective).",
          "BitLocker / BitLocker To Go vs EFS.",
          "Safe Mode; Startup Repair; System Restore; Reset/WinRE."],
   flashcards:[["Permissions precedence","Deny > Allow; explicit > inherited."],
               ["BitLocker vs EFS","Disk vs file/folder encryption."]]},
  {domain:"1. Operating Systems",code:"1.5",title:"Workgroup vs Domain & Net Basics",
   items:["Workgroup shares & mapped drives; domain join concept.",
          "Firewall profiles & per-app rules; RDP basics.",
          "Core 1 refresher: private IP ranges, common ports."],
   flashcards:[["Workgroup","Peer-to-peer, local accounts."],["Domain","Central auth via AD; GPOs apply."]]},
  {domain:"1. Operating Systems",code:"1.6",title:"macOS & Linux Essentials",
   items:["macOS: Time Machine, Disk Utility, Spotlight, Gatekeeper.",
          "Linux: ownership/permissions; apt/yum(dnf).",
          "Cross-platform paths & common commands."],
   flashcards:[["chmod 755","rwx r-x r-x (4/2/1)"],["Package mgmt","apt/yum; repo/update/upgrade/install"]]},
  {domain:"2. Security",code:"2.1",title:"Threats & Attacks",
   items:["Malware: virus, worm, trojan, ransomware, rootkit, keylogger.",
          "Social engineering: phishing/spear/vish/smish, pretexting.",
          "Network threats: DoS/DDoS, MITM, spoofing, brute force."],
   flashcards:[["Phishing vs Spear","Bulk vs targeted."],["MITM","Intercept/alter traffic in the path."]]},
  {domain:"2. Security",code:"2.2",title:"Hardening Workstations",
   items:["Account policies: lockout, length/history, MFA.",
          "Updates/patching; disable autorun; secure DNS.",
          "Secure BIOS/UEFI: passwords, Secure Boot, drive order."],
   flashcards:[["MFA","Something you know/have/are."],["Secure Boot","Blocks unsigned boot loaders."]]},
  {domain:"2. Security",code:"2.3",title:"Wireless & InfoSec Standards",
   items:["WEP/WPA2/WPA3; AES/TKIP; SAE; OWE on open.",
          "802.1X/RADIUS Enterprise vs PSK; captive portals.",
          "PII/PHI handling; data classification; DLP basics."],
   flashcards:[["WPA3","SAE; stronger against offline attacks."],["802.1X","Port-based NAC with RADIUS."]]},
  {domain:"2. Security",code:"2.4",title:"Windows Security Settings",
   items:["Defender AV/Firewall; def updates; exclusions.",
          "Per-app firewall rules; in/out basics.",
          "Permissions review; UAC tuning."],
   flashcards:[["Effective perms","Most restrictive wins."],["UAC levels","Notify behavior for user/admin."]]},
  {domain:"2. Security",code:"2.5",title:"Encryption & Data Protection",
   items:["BitLocker (TPM)/To Go; EFS; recovery keys.",
          "Device encryption; secure wipe vs shred.",
          "Backups: full/diff/incremental tradeoffs."],
   flashcards:[["Recovery keys","Store securely/out-of-band."],["Backup sets","Full+diff vs full+incr."]]},
  {domain:"3. Software Troubleshooting",code:"3.1",title:"Methodology & Tools",
   items:["6 steps; policies before changes.",
          "Event Viewer; msconfig/services; Task Manager.",
          "Safe Mode; Startup Repair; bootrec; SFC/DISM sequence."],
   flashcards:[["6 steps","Identify‚ÜíTheory‚ÜíTest‚ÜíPlan‚ÜíVerify‚ÜíDocument"],["bootrec","/fixmbr /fixboot /rebuildbcd"]]},
  {domain:"3. Software Troubleshooting",code:"3.2",title:"Symptoms & Fixes",
   items:["BSOD/drivers/RAM; app crashes; services not starting.",
          "Browser hijack/malware; slow profiles; update loops.",
          "No-boot: missing OS, loops, device order issues."],
   flashcards:[["Hijack signs","Homepage redirect, odd extensions."],["BSOD triage","Drivers/updates; stop code."]]},
  {domain:"4. Operational Procedures",code:"4.1",title:"Safety, Environmental & Docs",
   items:["ESD; MSDS/SDS; battery/toner; lifting.",
          "Inventory, ticketing, change mgmt, SOPs.",
          "Disposal: wipe/degauss/shred; chain of custody."],
   flashcards:[["Chain of custody","Who/what/when/where logs."],["E-waste","Policy & legal compliance."]]},
  {domain:"4. Operational Procedures",code:"4.2",title:"Professionalism & Best Practices",
   items:["Comms, escalation, SLAs, doc quality.",
          "Remote etiquette; permission & privacy.",
          "Licensing basics; scope/impact assessment."],
   flashcards:[["SLA","Uptime/response guarantees."],["Scope creep","Use change control."]]}
];

const PBQ_TASKS = [
  "Create a Windows local user, set password policy, test UAC behavior.",
  "Fix a no-boot: Safe Mode ‚Üí Startup Repair ‚Üí bootrec ‚Üí SFC/DISM.",
  "Choose correct Wi-Fi security (WPA3 vs WPA2), create firewall rule.",
  "Resolve access denied via NTFS vs Share permissions & inheritance.",
  "Perform malware removal in order, then post-incident hardening."
];
const FINAL_48 = [
  "Redrill Windows/Linux/macOS commands & switches.",
  "Review Operational Procedures (docs, safety, disposal, chain of custody).",
  "Recheck security protocols & MFA/password policy concepts.",
  "Skim your weak-topic flashcards and notes.",
  "Sleep 7‚Äì8 hours; test center/online check-in logistics ready."
];
const EXAMS = ["A","B","C","D","E","F"];

/* ===================== STATE & MIGRATION ===================== */
const KEY='a1102_andrew_tracker_v3';
function load(){ try{ return JSON.parse(localStorage.getItem(KEY)||''); }catch(e){ return null; } }
function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }
function migrate(){
  const old = localStorage.getItem('a1102_andrew_tracker_v2');
  if(old && !localStorage.getItem(KEY)){
    const parsed = JSON.parse(old);
    // Shallow carry-over of useful keys
    const migrated = {
      examDate: parsed.examDate || '',
      startDate: parsed.startDate || '',
      checks: parsed.checks || {},
      notes: parsed.notes || {},
      exams: parsed.exams || {},
      fc: parsed.fc || {known:[],unknown:[],i:0,showBack:false,filter:"All"},
      streak: parsed.streak || 0,
      lastDone: parsed.lastDone || ''
    };
    localStorage.setItem(KEY, JSON.stringify(migrated));
  }
}
migrate();
const state = load() || {
  startDate:'', examDate:'',
  checks:{}, notes:{}, exams:{},
  fc:{known:[],unknown:[],i:0,showBack:false,filter:"All"},
  streak:0,lastDone:'',
  customFC:[],            // {sec,front,back}
  reviewFlags:{}          // noteKey -> true
};

/* ===================== BUILD UI SECTIONS ===================== */
const sectionsEl = document.getElementById('sections');
const examsEl = document.getElementById('exams');
const pbqEl = document.getElementById('pbq');
const finalEl = document.getElementById('final48');
const totalCountEl = document.getElementById('totalCount');
const scheduleEl = document.getElementById('schedule');

function buildSections(){
  sectionsEl.innerHTML='';
  COURSE_MAP.forEach((s, idx)=>{
    const div=document.createElement('div');
    div.className='section';
    const noteKey=`sec:${idx}`;
    const reviewFlag = !!state.reviewFlags[noteKey];
    div.innerHTML = `
      <h4 style="margin:0">${s.domain} ‚Ä¢ ${s.code} ‚Äî ${s.title} ${reviewFlag?'<span class="badge" style="border-color:#6a1e1e;background:#2b1212">Needs Review</span>':''}</h4>
      <div class="list">
        ${s.items.map((t,i)=>`
          <label class="item"><input type="checkbox" data-k="sec:${idx}:${i}"> <span>${t}</span></label>
        `).join('')}
      </div>
      <details style="margin-top:8px" open>
        <summary>Notes</summary>
        <div class="row" style="justify-content:space-between;align-items:center;margin:6px 0">
          <div class="row">
            <label class="item"><input type="checkbox" data-review="${noteKey}" ${reviewFlag?'checked':''}> <span>Mark as <b>Needs Review</b></span></label>
          </div>
          <div class="row">
            <button class="btn" data-flash="${noteKey}" title="Scan Q:/A: pairs into flashcards">Make Flashcard</button>
          </div>
        </div>
        <textarea data-note="${noteKey}" placeholder="Tips: Use Q: and A: lines for auto-flashcards. Example:
Q: What does gpupdate /force do?
A: Applies Group Policy immediately.">${state.notes[noteKey]??''}</textarea>
      </details>
      ${s.flashcards?.length?`<details style="margin-top:8px"><summary>Section Flashcards</summary>
        <div class="list">${s.flashcards.map(fc=>`<div class="chip"><b>${fc[0]}:</b> ${fc[1]}</div>`).join('')}</div>
      </details>`:''}
    `;
    sectionsEl.appendChild(div);
  });
}

function buildExams(){
  examsEl.innerHTML='';
  EXAMS.forEach(letter=>{
    const k=`dion${letter}`;
    const eDiv=document.createElement('div');
    eDiv.className='section';
    eDiv.innerHTML=`
      <div class="row" style="justify-content:space-between">
        <h4 style="margin:0">Jason Dion Exam ${letter}</h4>
        <label class="pill">Score:
          <input type="number" min="0" max="100" step="1" data-exam-score="${k}"
            style="width:72px;background:#0e1622;border:1px solid #243245;color:#cfe1ff;border-radius:8px;padding:6px;margin-left:6px" value="${state.exams[k]?.score??''}">% 
        </label>
      </div>
      <div class="row">
        <label class="item"><input type="checkbox" data-exam-done="${k}" ${state.exams[k]?.done?'checked':''}> Mark complete</label>
        <select class="btn" data-exam-domain="${k}">
          <option value="">Link weak area ‚Üí</option>
          ${[...new Set(COURSE_MAP.map(s=>s.domain))].map(d=>`<option ${state.exams[k]?.domain===d?'selected':''}>${d}</option>`).join('')}
        </select>
      </div>
      <details style="margin-top:8px"><summary>Review notes (map misses back to sections)</summary>
        <textarea data-exam-note="${k}" placeholder="List unknown terms + matching section (e.g., 1.2, 2.4).">${state.notes[`note:${k}`]??''}</textarea>
      </details>
    `;
    examsEl.appendChild(eDiv);
  });
}

function buildPBQ(){ pbqEl.innerHTML= PBQ_TASKS.map((t,i)=>`
  <label class="item"><input type="checkbox" data-k="pbq:${i}"> <span>${t}</span></label>
`).join(''); }
function buildFinal(){ finalEl.innerHTML= FINAL_48.map((t,i)=>`
  <label class="item"><input type="checkbox" data-k="final:${i}"> <span>${t}</span></label>
`).join(''); }

buildSections(); buildExams(); buildPBQ(); buildFinal();

/* ===================== SCHEDULE ENGINE ===================== */
/* 15 study days + 6 flex. Uses Chen's pacing. Rolls forward when items incomplete. */
const DAY_PLAN = [
  ["1.1","1.2"],  // D1
  ["1.3","1.4a"], // D2 (half of 1.4)
  ["1.4b","1.5"], // D3
  ["1.6"],        // D4
  ["recap","pbq1"], // D5
  ["2.1","2.2"],  // D6
  ["2.3"],        // D7
  ["2.4","2.5"],  // D8
  ["3.1"],        // D9
  ["3.2","pbq2"], // D10
  ["examA"],      // D11
  ["rewatch","mix40"], // D12
  ["examB"],      // D13
  ["examC","pbq3"], // D14
  ["final"]       // D15
];
function secByCode(code){
  if(code.endsWith('a')||code.endsWith('b')) code=code.slice(0,-1);
  const i=COURSE_MAP.findIndex(s=>s.code===code);
  return i>=0? {idx:i, sec:COURSE_MAP[i]} : null;
}
function scheduleDates(){
  let start = state.startDate? new Date(state.startDate) : null;
  if(!start && state.examDate){
    // back-calc 21 days before exam for schedule start
    start = new Date(state.examDate);
    start.setDate(start.getDate()-20);
  }
  if(!start){ return []; }
  const days=[];
  for(let i=0;i<21;i++){
    const d=new Date(start); d.setDate(start.getDate()+i);
    days.push(d.toISOString().slice(0,10));
  }
  return days;
}
function humanTask(token){
  if(token.startsWith('1.')||token.startsWith('2.')||token.startsWith('3.')||token.startsWith('4.')){
    const base=token.replace(/[ab]$/,'');
    const found=secByCode(base); if(!found) return token;
    const label=found.sec.title + (token.endsWith('a')?' (part 1)':'' ) + (token.endsWith('b')?' (part 2)':'');
    return `${base} ‚Äî ${label}`;
  }
  const map={
    recap:"Recap weak points + 30‚Äì40 mixed Qs",
    pbq1:"PBQ drill #1",
    pbq2:"PBQ drill #2",
    pbq3:"PBQ drill #3",
    examA:"Jason Dion Exam A (full, timed) + review",
    examB:"Jason Dion Exam B + review",
    examC:"Jason Dion Exam C + review",
    rewatch:"Targeted rewatch of missed sections",
    mix40:"25‚Äì50 mixed questions",
    final:"Final polish (commands, security, ops) + light mixed set"
  };
  return map[token]||token;
}
function buildSchedule(){
  scheduleEl.innerHTML='';
  const dates=scheduleDates();
  if(!dates.length){ scheduleEl.innerHTML='<div class="sub">Set a start or exam date to generate the schedule.</div>'; return; }
  const todayStr = new Date().toISOString().slice(0,10);
  // create 15 study entries spread across first 18‚Äì19 days, leave ~6 flex total
  // Simple mapping: place DAY_PLAN on first 15 non-flex slots; flex on remaining
  const planDays=[];
  let pi=0;
  for(let i=0;i<dates.length;i++){
    if(pi<DAY_PLAN.length){
      planDays.push({date:dates[i], tasks:DAY_PLAN[pi++]});
    }else{
      planDays.push({date:dates[i], tasks:["flex"]});
    }
  }
  // Render
  planDays.forEach((d)=>{
    const isToday = d.date===todayStr;
    const div=document.createElement('div');
    div.className='schedule-day'+(isToday?' today':'');
    const left=document.createElement('div');
    left.innerHTML=`<div><b>${d.date}</b> ${isToday?'<span class="badge">Today</span>':''}</div>
      <div class="sub">${d.tasks[0]==='flex'?'Flex/Make-up day': d.tasks.map(humanTask).join(' ‚Ä¢ ')}</div>`;
    const right=document.createElement('div');
    if(d.tasks[0]!=='flex'){
      const btn=document.createElement('button'); btn.className='btn brand'; btn.textContent=isToday?'Start Session':'View';
      btn.onclick=()=>scrollToFirstTask(d.tasks);
      right.appendChild(btn);
    }else{
      const span=document.createElement('span'); span.className='pill'; span.textContent='Rest/Catch-up';
      right.appendChild(span);
    }
    div.appendChild(left); div.appendChild(right);
    scheduleEl.appendChild(div);
  });
}
function scrollToFirstTask(tokens){
  // find first token's section and focus its checklist
  for(const t of tokens){
    if(/^([1-4]\.\d+)/.test(t)){
      const sc=secByCode(t.replace(/[ab]$/,''));
      if(sc){
        const node=sectionsEl.children[sc.idx];
        if(node){ node.scrollIntoView({behavior:'smooth',block:'start'}); }
        break;
      }
    }
  }
}

/* ===================== CHECKS + SYNC ===================== */
const planChecks = ()=>[...document.querySelectorAll('input[type="checkbox"][data-k]')];
function weightedProgress(){
  const domainStats = {};
  COURSE_MAP.forEach((s, si)=>{
    const items = s.items.length;
    const done = s.items.filter((_,i)=> state.checks[`sec:${si}:${i}`]).length;
    (domainStats[s.domain]??=( {done:0,total:0} ));
    domainStats[s.domain].done += done;
    domainStats[s.domain].total += items;
  });
  let weighted=0,totalWeight=0;
  Object.keys(DOMAIN_WEIGHTS).forEach(d=>{
    const w=DOMAIN_WEIGHTS[d]||0;
    const stat=domainStats[d]||{done:0,total:0};
    const pct=stat.total?(stat.done/stat.total):0;
    weighted += pct*w; totalWeight += w;
  });
  return Math.round((weighted/totalWeight)*100);
}
function totalItemsCount(){
  const planCount = COURSE_MAP.reduce((a,s)=>a+s.items.length,0);
  const miscCount = PBQ_TASKS.length + FINAL_48.length + EXAMS.length;
  return planCount + miscCount;
}
function doneItemsCount(){
  const planDone = Object.keys(state.checks).filter(k=>k.startsWith('sec:') && state.checks[k]).length;
  const pbqDone = PBQ_TASKS.map((_,i)=> state.checks[`pbq:${i}`]).filter(Boolean).length;
  const finalDone = FINAL_48.map((_,i)=> state.checks[`final:${i}`]).filter(Boolean).length;
  const examsDone = EXAMS.map(l=>state.exams[`dion${l}`]?.done).filter(Boolean).length;
  return planDone + pbqDone + finalDone + examsDone;
}
function nextSuggestion(){
  for(let si=0; si<COURSE_MAP.length; si++){
    for(let ii=0; ii<COURSE_MAP[si].items.length; ii++){
      if(!state.checks[`sec:${si}:${ii}`]){
        document.getElementById('nextUp').textContent=`Next up: ${COURSE_MAP[si].domain} ‚Üí ${COURSE_MAP[si].code} ‚Äî ${COURSE_MAP[si].title} ‚Üí ${COURSE_MAP[si].items[ii]}`;
        return;
      }
    }
  }
  for(const l of EXAMS){ if(!state.exams[`dion${l}`]?.done){ document.getElementById('nextUp').textContent=`Next up: Jason Dion Exam ${l}`; return; } }
  for(let i=0;i<PBQ_TASKS.length;i++){ if(!state.checks[`pbq:${i}`]){ document.getElementById('nextUp').textContent=`Next up: ${PBQ_TASKS[i]}`; return; } }
  for(let i=0;i<FINAL_48.length;i++){ if(!state.checks[`final:${i}`]){ document.getElementById('nextUp').textContent=`Next up: ${FINAL_48[i]}`; return; } }
  document.getElementById('nextUp').textContent='All tasks complete. Light review + rest.';
}
function renderCountdown(){
  const el=document.getElementById('countdown');
  if(!state.examDate && !state.startDate){ el.textContent='Set a start or exam date to generate your plan.'; return; }
  if(state.examDate){
    const now=new Date(); const d=new Date(state.examDate+'T00:00:00');
    const diff=Math.ceil((d-now)/(1000*60*60*24));
    el.textContent = diff>=0 ? `‚è≥ ${diff} day(s) until exam.` : `‚úÖ Exam date passed (${Math.abs(diff)} day(s) ago).`;
  }else{
    el.textContent = `Schedule from ${state.startDate}`;
  }
}
function markStreak(){
  const today=new Date().toISOString().slice(0,10);
  if(state.lastDone===today) return;
  if(!state.lastDone){ state.streak=1; state.lastDone=today; return; }
  const d1=new Date(state.lastDone), d2=new Date(today);
  const diff=(d2-d1)/(1000*60*60*24);
  state.streak = (diff===1)? state.streak+1 : 1;
  state.lastDone=today;
}
function syncUI(){
  // checks
  planChecks().forEach(c=> c.checked = !!state.checks[c.dataset.k]);
  // progress
  document.getElementById('pct').textContent = weightedProgress()+'%';
  document.getElementById('bar').style.width = weightedProgress()+'%';
  document.getElementById('doneCount').textContent = doneItemsCount();
  document.getElementById('totalCount').textContent = totalItemsCount();
  document.getElementById('streak').textContent = state.streak||0;
  nextSuggestion(); renderCountdown(); buildSchedule();
}

/* ===================== EVENTS ===================== */
document.addEventListener('change',(e)=>{
  const t=e.target;
  if(t.matches('input[type="checkbox"][data-k]')){
    state.checks[t.dataset.k]=t.checked; if(t.checked) markStreak(); save(); syncUI();
  }
  if(t.matches('textarea[data-note]')){
    state.notes[t.dataset.note]=t.value; save();
  }
  if(t.matches('input[data-exam-done]')){
    const k=t.dataset.examDone; state.exams[k]=state.exams[k]||{}; state.exams[k].done=t.checked; if(t.checked) markStreak(); save(); syncUI();
  }
  if(t.matches('input[data-exam-score]')){
    const k=t.dataset.examScore; state.exams[k]=state.exams[k]||{}; state.exams[k].score=t.value; save();
  }
  if(t.matches('select[data-exam-domain]')){
    const k=t.dataset.examDomain; state.exams[k]=state.exams[k]||{}; state.exams[k].domain=t.value; save();
  }
  if(t.id==='startDate'){ state.startDate=t.value; save(); syncUI(); }
  if(t.id==='examDate'){ state.examDate=t.value; save(); syncUI(); }
  if(t.matches('input[data-review]')){
    const key=t.dataset.review; state.reviewFlags[key]=t.checked; save(); buildSections(); syncUI();
  }
});

document.addEventListener('click',(e)=>{
  const t=e.target;
  if(t.matches('.copy')){ navigator.clipboard.writeText(t.dataset.copy); }
  if(t.matches('button[data-flash]')){
    const key=t.dataset.flash; const txt=(state.notes[key]||'')+'';
    const pairs = extractQA(txt);
    pairs.forEach(p=> state.customFC.push({sec:key,front:p.q,back:p.a}));
    save(); renderReviewQueue();
    toast(pairs.length?`Added ${pairs.length} flashcard(s)`: 'No Q:/A: pairs found');
  }
});

/* ===================== HEADER COLLAPSE ===================== */
const hdr=document.getElementById('hdr');
const collapseBtn=document.getElementById('collapseBtn');
collapseBtn.onclick=()=>{
  hdr.classList.toggle('collapsed');
  document.getElementById('chev').textContent = hdr.classList.contains('collapsed')?'‚¨á':'‚¨Ü';
};

/* ===================== GLOSSARY ===================== */
const GLOSSARY = [
 {k:'sfc',v:'System File Checker ‚Äî verify/repair protected Windows files.'},
 {k:'dism',v:'Deployment Image Servicing and Management ‚Äî repair component store.'},
 {k:'bitlocker',v:'Full-disk encryption (TPM).'},
 {k:'efs',v:'Encrypting File System ‚Äî per-file (NTFS).'},
 {k:'uac',v:'User Account Control ‚Äî elevation prompts.'},
 {k:'ntfs',v:'Permissions: read/write/modify/full; most restrictive effective.'},
 {k:'share permissions',v:'Apply only over network; combine with NTFS.'},
 {k:'wpa2',v:'Wi-Fi security (AES/TKIP) ‚Äî legacy vs WPA3.'},
 {k:'wpa3',v:'Wi-Fi security using SAE; resists offline attacks.'},
 {k:'apipa',v:'169.254.x.x when no DHCP lease.'},
 {k:'bsod',v:'Kernel crash; check drivers/RAM/updates.'},
 {k:'gpupdate',v:'Refresh Group Policy (Windows).'},
 {k:'chmod',v:'Change file mode bits (Linux/macOS).'},
 {k:'grep',v:'Search text with regex; -R recursive.'},
 {k:'chain of custody',v:'Evidence handling log (forensics).'},
 {k:'mfa',v:'Multi-factor auth.'},
 {k:'sla',v:'Service Level Agreement.'},
];
function runGlossary(q, outEl){
  outEl.innerHTML='';
  if(!q) return;
  GLOSSARY.filter(x=>x.k.includes(q)||x.v.toLowerCase().includes(q.toLowerCase()))
    .slice(0,20).forEach(x=>{
      const row=document.createElement('div'); row.className='chip';
      row.innerHTML=`<b>${x.k}</b> ‚Äî ${x.v}`;
      outEl.appendChild(row);
    });
}
document.getElementById('search').addEventListener('input',e=>runGlossary(e.target.value, document.getElementById('results')));
document.getElementById('searchOv').addEventListener('input',e=>runGlossary(e.target.value, document.getElementById('resultsOv')));
const ov=document.getElementById('glossaryOverlay');
document.getElementById('openGlossary').onclick=()=>{ ov.style.display='flex'; document.getElementById('searchOv').focus(); };
document.getElementById('closeGlossary').onclick=()=>{ ov.style.display='none'; };

/* ===================== FLASHCARDS ===================== */
const fcSelect = document.getElementById('fcSection');
function buildDeck(){
  const pairs=[];
  COURSE_MAP.forEach((s,i)=>{
    (s.flashcards||[]).forEach(fc=>pairs.push({sec:`${s.code} ‚Äî ${s.title}`,front:fc[0],back:fc[1]}));
  });
  // custom flashcards from notes (Q:/A:)
  state.customFC.forEach(c=>{
    // map note key (sec:idx) to section label if possible
    let label='Custom';
    const m=c.sec.match(/^sec:(\d+)/);
    if(m){ const si=+m[1]; if(COURSE_MAP[si]) label=`${COURSE_MAP[si].code} ‚Äî ${COURSE_MAP[si].title}`; }
    pairs.push({sec:label,front:c.front,back:c.back});
  });
  return pairs;
}
let DECK = buildDeck();
function fcSections(){
  const opts = ["All", ...[...new Set(buildDeck().map(c=>c.sec))]];
  fcSelect.innerHTML = opts.map(o=>`<option ${state.fc.filter===o?'selected':''}>${o}</option>`).join('');
}
fcSections();
function filterDeck(){ const all=buildDeck(); return state.fc.filter==="All"? all : all.filter(c=>c.sec===state.fc.filter); }
function fcInit(){
  const pool = filterDeck();
  if(!pool.length){
    document.getElementById('fcFront').textContent='No flashcards in this filter.';
    document.getElementById('fcBack').textContent='Add Q:/A: in notes, then ‚ÄúMake Flashcard‚Äù.';
    document.getElementById('fcStatus').textContent='';
    return;
  }
  if(!state.fc.unknown.length && !state.fc.known.length){
    state.fc.unknown = pool.map((_,i)=>i);
    state.fc.known = []; state.fc.i=0; state.fc.showBack=false; save();
  }
  fcRender();
}
function fcCurrent(){
  const pool = filterDeck();
  const active = state.fc.unknown.length? state.fc.unknown : state.fc.known;
  if(!active.length) return null;
  const idx = Math.min(state.fc.i, active.length-1);
  return {pool, idx, card: pool[ active[idx] ]};
}
function fcRender(){
  const cur = fcCurrent();
  const f=document.getElementById('fcFront'), b=document.getElementById('fcBack'), s=document.getElementById('fcStatus');
  if(!cur){ f.textContent='Deck empty'; b.textContent='Reset deck'; s.textContent=''; return; }
  f.textContent = cur.card.front + (state.fc.filter==="All" ? `  ¬∑  ${cur.card.sec}` : "");
  b.textContent = state.fc.showBack? cur.card.back : 'Tap ‚ÄúFlip‚Äù to reveal';
  s.textContent = `Unknown: ${state.fc.unknown.length} ‚Ä¢ Known: ${state.fc.known.length}`;
}
function fcFlip(){ state.fc.showBack=!state.fc.showBack; save(); fcRender(); }
function fcAdvance(dir=1){
  const active = state.fc.unknown.length? state.fc.unknown : state.fc.known;
  state.fc.i = (state.fc.i + dir + active.length) % active.length;
  state.fc.showBack=false; save(); fcRender();
}
function fcMove(toKnown){
  const cur = fcCurrent(); if(!cur) return;
  const active = state.fc.unknown.length? state.fc.unknown : state.fc.known;
  const idx = active[state.fc.i];
  // remove current
  state.fc.unknown = state.fc.unknown.filter(i=>i!==idx);
  state.fc.known = state.fc.known.filter(i=>i!==idx);
  (toKnown? state.fc.known: state.fc.unknown).push(idx);
  state.fc.showBack=false; save(); fcRender();
}
document.getElementById('fcFlip').onclick=fcFlip;
document.getElementById('fcPrev').onclick=()=>fcAdvance(-1);
document.getElementById('fcKnown').onclick=()=>fcMove(true);
document.getElementById('fcUnknown').onclick=()=>fcMove(false);
document.getElementById('fcReset').onclick=()=>{ state.fc.known=[]; state.fc.unknown=[]; state.fc.i=0; state.fc.showBack=false; save(); fcInit(); };
fcSelect.addEventListener('change',()=>{ state.fc.filter=fcSelect.value; state.fc.known=[]; state.fc.unknown=[]; state.fc.i=0; state.fc.showBack=false; save(); fcInit(); });
fcInit();

/* ===================== REVIEW EXPORTS ===================== */
function collectReview(){
  const out=[];
  Object.keys(state.reviewFlags).forEach(k=>{
    if(state.reviewFlags[k]){
      const m=k.match(/^sec:(\d+)/); let head='(Unknown Section)';
      if(m){ const si=+m[1]; if(COURSE_MAP[si]) head=`${COURSE_MAP[si].code} ${COURSE_MAP[si].title} (${COURSE_MAP[si].domain})`; }
      out.push({type:'note', section:head, text:(state.notes[k]||'').trim()});
    }
  });
  const cards = state.customFC.map(c=>{
    let label='Custom'; const m=c.sec.match(/^sec:(\d+)/);
    if(m){ const si=+m[1]; if(COURSE_MAP[si]) label=`${COURSE_MAP[si].code} ${COURSE_MAP[si].title} (${COURSE_MAP[si].domain})`; }
    return {type:'card', section:label, q:c.front, a:c.back};
  });
  return {notes:out, cards};
}
function exportMD(){
  const {notes,cards}=collectReview();
  let md=`# A+ 220-1102 Review Pack (Generated ${new Date().toLocaleDateString()})\n\n`;
  // group notes by section
  const bySec={};
  notes.forEach(n=>{ (bySec[n.section]??=[]).push(n); });
  Object.keys(bySec).forEach(sec=>{
    md+=`## ${sec}\n`;
    bySec[sec].forEach(n=>{ if(n.text) md+=`- NOTE: ${n.text}\n`; });
    const scCards = cards.filter(c=>c.section===sec);
    if(scCards.length){ md+=`\n### Flashcards\n`; scCards.forEach(c=>{ md+=`Q: ${c.q}\nA: ${c.a}\n\n`; }); }
    md+='\n';
  });
  download('a1102_review.md', md);
}
function exportCSV(){
  const {notes,cards}=collectReview();
  const rows=[['Type','Section','Note/Question','Answer']];
  notes.forEach(n=>rows.push(['Note', n.section, n.text.replace(/\n/g,' '), '']));
  cards.forEach(c=>rows.push(['Card', c.section, c.q.replace(/\n/g,' '), c.a.replace(/\n/g,' ')]));
  const csv=rows.map(r=>r.map(x=>`"${(x||'').replace(/"/g,'""')}"`).join(',')).join('\n');
  download('a1102_review.csv', csv);
}
function exportTSV(){
  const {cards}=collectReview();
  const tsv = cards.map(c=>`${c.q}\t${c.a}`).join('\n');
  download('a1102_anki.txt', tsv);
}
function download(name, text){
  const blob=new Blob([text],{type:'text/plain'}); const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download=name; a.click(); URL.revokeObjectURL(url);
}
document.getElementById('exportMD').onclick=exportMD;
document.getElementById('exportCSV').onclick=exportCSV;
document.getElementById('exportTSV').onclick=exportTSV;

function renderReviewQueue(){
  const box=document.getElementById('reviewList'); box.innerHTML='';
  const {notes,cards}=collectReview();
  if(!notes.length && !cards.length){ box.innerHTML='<div class="sub">Nothing tagged yet. Mark notes as ‚ÄúNeeds Review‚Äù or add Q:/A: then click ‚ÄúMake Flashcard‚Äù.</div>'; return; }
  notes.forEach(n=>{
    const div=document.createElement('div'); div.className='section';
    div.innerHTML=`<div><b>${n.section}</b></div><div class="sub">${n.text? n.text.replace(/\n/g,'<br>') : '(empty note)'}</div>`;
    box.appendChild(div);
  });
  cards.forEach(c=>{
    const div=document.createElement('div'); div.className='section';
    div.innerHTML=`<div><b>${c.section}</b></div><div class="sub">Q: ${c.q}</div><div class="sub">A: ${c.a}</div>`;
    box.appendChild(div);
  });
}
renderReviewQueue();

/* ===================== HELPERS ===================== */
function extractQA(txt){
  const lines=txt.split('\n').map(x=>x.trim());
  const pairs=[]; let q=null;
  for(const line of lines){
    if(/^q\s*:/.test(line.toLowerCase())){ q=line.replace(/^q\s*:\s*/i,''); }
    else if(/^a\s*:/.test(line.toLowerCase()) && q!==null){ const a=line.replace(/^a\s*:\s*/i,''); pairs.push({q:q.trim(),a:a.trim()}); q=null; }
  }
  return pairs;
}
function toast(msg){
  const t=document.createElement('div');
  t.textContent=msg; t.style.cssText='position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:#111a29;border:1px solid #274060;padding:8px 12px;border-radius:10px;color:#cfe1ff;z-index:9999';
  document.body.appendChild(t); setTimeout(()=>t.remove(),1300);
}

/* ===================== EXPORT/IMPORT/RESET ===================== */
document.getElementById('exportBtn').onclick=()=>{
  const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob); const a=document.createElement('a');
  a.href=url;a.download='a1102_progress.json';a.click(); URL.revokeObjectURL(url);
};
document.getElementById('importFile').onchange=(e)=>{
  const f=e.target.files[0]; if(!f) return;
  const r=new FileReader();
  r.onload=()=>{ try{ const obj=JSON.parse(r.result); Object.assign(state,obj); save(); location.reload(); }catch(err){alert('Invalid JSON');} };
  r.readAsText(f);
};
document.getElementById('resetBtn').onclick=()=>{ if(confirm('Clear all saved progress?')){ localStorage.removeItem(KEY); location.reload(); } };

/* ===================== INIT ===================== */
document.getElementById('startDate').value = state.startDate||'';
document.getElementById('examDate').value = state.examDate||'';

function initialSync(){
  // set initial checkbox states
  planChecks().forEach(c=> c.checked = !!state.checks[c.dataset.k]);
  // reattach listeners for newly built sections
  sectionsEl.querySelectorAll('textarea[data-note]').forEach(n=>{
    n.addEventListener('input', e=>{ state.notes[n.dataset.note]=n.value; save(); });
  });
}
initialSync();
syncUI();
</script>
</body>
</html>
